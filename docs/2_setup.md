<div style="page-break-before:always;">
</div>

# <a name="setup_natch"></a>2. Установка и настройка Natch

## <a name="complect"></a>2.1. Комплект поставки Natch

Инструмент *Natch* состоит из двух частей: непосредственно *Natch*, который используется для
сбора информации о работе объекта оценки, и графическая подсистема *SNatch*, в которой происходит обработка
собранных данных и построение аналитик.

Для использования лицензионной версии *Natch* необходимо получить аппаратный или сетевой ключ и провести настройку окружения.
Подробная инструкция находится в разделе [Настройка окружения для использования лицензированного Natch](app1_license.md#app_license).

В комплект поставки инструмента входит пакет *Natch*, архив *SNatch* и документация.

Инструменты *Natch* и *SNatch* распространяются в виде установочных пакетов для следующих операционных систем:

* Alt 10, 11
* Astra 1.7, 1.8
* Debian 11, 12
* Ubuntu 22, 24
* РЕД ОС 8

В пакете представлен защищенный бинарный дистрибутив, требующий наличия аппаратного ключа (персональный "черный" ключ,
сетевой "красный" ключ или иные версии ключа) с лицензией c идентификатором "6".

[Дистрибутив Natch v.3.3](https://nextcloud.ispras.ru/index.php/s/9TcYb2GoFpaZtE7)

[Предыдущие релизы](app9_releases.md#app_releases)


## 2.2. Установка инструмента Natch

Установка *Natch* происходит в два этапа:

* установка пакета в соответствии с хостовой ОС
* установка зависимостей (встроена в установку пакета на всех ОС кроме Astra)

### 2.2.1. Установка пакета Natch

В связи с переходом на новую версию аппаратных ключей инструмента лицензирования Sentinel до окончания действия всех выданных лицензий будут
поддерживаться два варианта дистрибутива. Если у вас старые ключи Sentinel, то следует брать дистрибутив из папки Sentinel_YM, если вы
новый пользователь *Natch* -- дистрибутив для вас в папке Sentinel_XE. Так же рекомендуется переустановить окружение
(aksusbd_*current_version*\_amd64.deb для Ubuntu/Debian/Astra), пакет находится в папке с дистрибутивом. Для Alt необходимо выполнить epm play aksusbd.

Как понять какой у вас ключ: с обратной стороны аппаратного ключа указан серийный номер. Обратите внимание на третью строчку, если
текст начинается с "XE" значит у вас новый ключ, если с "YM" -- старый.

**Установка для Ubuntu, Debian и Astra**

Для установки *Natch* скачайте соответствующий вашей ОС дистрибутив и используйте команду (пример для ubuntu24):

```
sudo dpkg -i natch_x.x_ubuntu24.deb
```
При возникновении ошибки *dpkg: depencency problems prevent configuration of natch* выполните команду:

```
sudo apt --fix-broken install -y.
```

Для обновления *Natch* предварительно требуется удаление установленной версии. Для удаления *Natch* из системы используйте команду:

```
sudo apt-get --yes --purge remove natch
```

**Установка для Alt**

Если на машине не установлен pip, то перед установкой пакета следует выполнить команду:

```
sudo apt-get install python3-module-pip
```

Для установки *Natch* скачайте дистрибутив и используйте команду (пример для Alt 11):
```
sudo apt-get install natch_x.x_alt11.rpm
```
Для обновления *Natch* предварительно требуется удаление установленной версии. Для удаления *Natch* из системы используйте команду:
```
sudo apt-get --yes --purge remove natch
```

**Установка для РЕД ОС**

Если на машине не установлен pip, то перед установкой пакета следует выполнить команду:

```
sudo dnf install python3-module-pip
```

Для установки *Natch* скачайте дистрибутив и используйте команду:
```
sudo dnf install natch_x.x_redos8.rpm
```
Для обновления *Natch* предварительно требуется удаление установленной версии. Для удаления *Natch* из системы используйте команду:
```
sudo dnf remove natch
```

___

При установке *Natch* бинарные файлы распаковываются в ``/usr/bin/natch-bin/``.

### 2.2.2. Установка зависимостей (Astra Linux)

После успешной установки *Natch* следует установить зависимости, необходимые для работы скриптов.
Для этого нужно запустить скрипт `setup_requirements.sh`, находящийся в папке установки инструмента:

```
/usr/bin/natch-bin/bin/natch_scripts/setup_requirements.sh
```
Во время выполнения скрипта потребуется пароль администратора.

Для хостовых систем Alt, Ubuntu, Debian, РЕД ОС установка зависимостей таким способом не требуется.

Для хостовых систем Astra Linux 1.7-1.8 требуется сервис unionfs, отсутствующий в apt. В случае работы с контейнерами
в гостевых системах на этих хостовых системах можно [скачать по ссылке](https://pkgs.org/download/unionfs-fuse) и установить deb пакет для Debian 12.

## <a name="setup_snatch"></a>2.3. Установка графической подсистемы SNatch

Установка *SNatch* происходит в несколько этапов:

* установка пакета в соответствии с хостовой ОС, включает установку зависимых пакетов

После установки SNatch автоматически выполняется проверка свободного дискового пространства в директории $HOME/snatch/media/, которая используется для хранения проектных данных. Вы увидите сообщение с результатами проверки:
```
62G available in /home/user/snatch/media/ where SNatch stores an unpacked data for analysis. It can be okay for very short scenarios, but for the longer scenarios the hundreds of GB could be required.
```

* конфигурирование базы данных (встроена в установку пакета на всех ОС кроме Alt и РЕД ОС).

После конфигурирования в терминале будут выведены учетные данные для подключения к БД (произвольный пароль генерируется автоматически):
```
Remember the PostgreSQL credentials:
==========================================
 DB name: snatch_db
 Username: snatch_user
 Password: zc03c03OwmEN80dHY
==========================================
```
[Конфигурирование БД на Alt и РЕД ОС](2_setup.md#snatch_configure)


* запуск необходимых сервисов, включая запуск самого SNatch (встроен в установку пакета на всех ОС кроме Alt и РЕД ОС)

[Запуск Snatch на Alt и РЕД ОС](2_setup.md#snatch_start)

 
По завершении SNatch автоматически откроется в браузере. Он доступен по адресу http://localhost:8000. Если страница не загрузилась автоматически, обновите ее через несколько секунд.

Если все прошло корректно вы увидите приглашение *Войти*. 

Обратите внимание, что не нужно пытаться использовать здесь учетные данные БД PostgreSQL, которые были показаны ранее.

Нажмите на кнопку *Зарегистрироваться* и создайте учетную запись для вашего пользователя. После этого вы автоматически выполните вход в Snatch и сможете загрузить ваш сценарий, полученный в Natch.



  
**Установка для Ubuntu, Debian и Astra**

Для установки *SNatch* скачайте соответствующий вашей ОС дистрибутив и используйте команду (пример для ubuntu24):

```
sudo dpkg -i snatch_x.x_ubuntu24.deb
```
При возникновении ошибки *dpkg: depencency problems prevent configuration of natch* выполните команду:

```
sudo apt --fix-broken install -y.
```

Для обновления *SNatch* предварительно требуется удаление установленной версии. Для удаления *SNatch* из системы используйте команду:
```
sudo apt-get --yes --purge remove snatch
```

**Установка для Alt**

Если на машине не установлен pip, то перед установкой пакета следует выполнить команду:

```
sudo apt-get install python3-module-pip
```

Для установки *SNatch* скачайте дистрибутив и используйте команду (пример для Alt 11):
```
sudo apt-get install snatch_x.x_alt11.rpm
```

Для обновления *SNatch* предварительно требуется удаление установленной версии. Для удаления *SNatch* из системы используйте команду:
```
sudo apt-get --yes --purge remove snatch
```

**Установка для РЕД ОС**

Если на машине не установлен pip, то перед установкой пакета следует выполнить команду:

```
sudo dnf install python3-pip
```

Для установки *SNatch* скачайте дистрибутив и используйте команду:
```
sudo dnf install snatch_x.x_redos8.rpm
```

Для обновления *SNatch* предварительно требуется удаление установленной версии. Для удаления *SNatch* из системы используйте команду:
```
sudo dnf remove snatch
```

### <a name="snatch_configure"></a> **Конфигурирование базы данных для Alt и РЕД ОС**

`Данная операция не требуется для ОС Astra Linux, Debian, Ubuntu.`


После установки вы увидите сообщение:
```
To finish SNatch setup run /usr/bin/snatch/configure.sh
```

Запустите скрипт *configure.sh*. 

На Alt 11 появится запрос *Введите новый пароль суперпользователя* для БД PosgreSQL. Задайте и повторите его. Через пару секунд его потребуется ввести снова.

На всех ОС будет выполнено создание и конфигурирование БД, после чего появится сообщение, содержащее учетные данные для подключения к БД (произвольный пароль генерируется автоматически) и команду для запуска Snatch:
```
Remember the PostgreSQL credentials:
==========================================
 DB name: snatch_db
 Username: snatch_user
 Password: zc03c03OwmEN80dHY
==========================================
```

### <a name="snatch_start"></a> **Запуск SNatch на Alt и РЕД ОС**

Для запуска SNatch на Alt и РЕД ОС используйте скрипт */usr/bin/snatch/run.sh*. Это потребует прав суперпользователя для запуска зависимых служб. По завершении вы увидите сообщение:
```
SNatch is up and running.
```

Snatch запускается автоматически после установки на ОС Astra Linux, Debian и Ubuntu. Для запуска на этих ОС после перезагрузки системы используйте скрипт */usr/bin/snatch/snatch_start.sh*
___

При установке *SNatch* бинарные файлы распаковываются в ``/usr/bin/snatch/``.


Обращаем ваше внимание, что для ОС Astra Linux версии 1.7 подсистема *SNatch* не предусмотрена. Изучать результаты, полученные в Astra, можно будет на любой другой поддерживаемой ОС.

