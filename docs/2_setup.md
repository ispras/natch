<div style="page-break-before:always;">
</div>

# <a name="setup_natch"></a>2. Установка и настройка Natch

## <a name="complect"></a>2.1. Комплект поставки Natch

Инструмент *Natch* состоит из двух частей: непосредственно *Natch*, который используется для
сбора информации о работе объекта оценки, и графическая подсистема *SNatch*, в которой происходит обработка
собранных данных и построение аналитик.

Для использования лицензионной версии *Natch* необходимо получить аппаратный или сетевой ключ и провести настройку окружения.
Подробная инструкция находится в разделе [Настройка окружения для использования лицензированного Natch](app1_license.md#app_license).

В комплект поставки инструмента входит пакет *Natch*, архив *SNatch* и документация.

Инструмент *Natch* распространяется в виде пакета для следующих операционных систем:

* Ubuntu 22, 24
* Debian 11, 12
* Alt 10
* Astra 1.7 ([требуется настройка системы](#setup_astra)), 1.8

В пакете представлен защищенный бинарный дистрибутив, требующий наличия аппаратного ключа (персональный "черный" ключ,
сетевой "красный" ключ или иные версии ключа) с лицензией c идентификатором "6".

[Дистрибутив Natch v.3.3](https://nextcloud.ispras.ru/index.php/s/9TcYb2GoFpaZtE7)

[Предыдущие релизы](app9_releases.md#app_releases)


## 2.2. Установка инструмента Natch

Установка *Natch* происходит в два этапа:

* установка пакета в соответствии с хостовой ОС
* установка зависимостей (встроена в установку пакета на всех ОС кроме Astra)

### 2.2.1. Установка пакета Natch

В связи с переходом на новую версию аппаратных ключей инструмента лицензирования Sentinel до окончания действия всех выданных лицензий будут
поддерживаться два варианта дистрибутива. Если у вас старые ключи Sentinel, то следует брать дистрибутив из папки Sentinel_YM, если вы
новый пользователь *Natch* -- дистрибутив для вас в папке Sentinel_XE. Так же рекомендуется переустановить окружение
(aksusbd_*current_version*\_amd64.deb для Ubuntu/Debian/Astra), пакет находится в папке с дистрибутивом. Для Alt необходимо выполнить epm play aksusbd.

Как понять какой у вас ключ: с обратной стороны аппаратного ключа указан серийный номер. Обратите внимание на третью строчку, если
текст начинается с "XE" значит у вас новый ключ, если с "YM" -- старый.

**Установка для Ubuntu, Debian и Astra**

Для установки *Natch* скачайте соответствующий вашей ОС дистрибутив и используйте команду (пример для ubuntu24):

```
sudo dpkg -i natch_x.x_ubuntu24.deb
```
При возникновении ошибки *dpkg: depencency problems prevent configuration of natch* выполните команду:

```
sudo apt --fix-broken install -y.
```

Для обновления *Natch* предварительно требуется удаление установленной версии. Для удаления *Natch* из системы используйте команду:

```
sudo apt-get --yes --purge remove natch
```

**Установка для Alt**

Если на машине не установлен pip, то перед установкой пакета следует выполнить команду:

```
sudo apt-get install python3-module-pip
```

Для установки *Natch* скачайте дистрибутив и используйте команду:
```
sudo apt-get install natch_x.x_alt10.rpm
```
Для обновления *Natch* предварительно требуется удаление установленной версии. Для удаления *Natch* из системы используйте команду:
```
sudo apt-get --yes --purge remove natch
```

___

При установке *Natch* бинарные файлы распаковываются в ``/usr/bin/natch-bin/``.

### 2.2.2. Установка зависимостей (Astra Linux)

После успешной установки *Natch* следует установить зависимости, необходимые для работы скриптов.
Для этого нужно запустить скрипт `setup_requirements.sh`, находящийся в папке установки инструмента:

```
/usr/bin/natch-bin/bin/natch_scripts/setup_requirements.sh
```
Во время выполнения скрипта потребуется пароль администратора.

Для хостовых систем Alt, Ubuntu, Debian установка зависимостей таким способом не требуется.

Для хостовых систем Astra Linux 1.7-1.8 требуется сервис unionfs, отсутствующий в apt. В случае работы с контейнерами
в гостевых системах на этих хостовых системах можно [скачать по ссылке](https://pkgs.org/download/unionfs-fuse) и установить deb пакет для Debian 12.

### <a name="setup_astra"></a>2.2.3. Настройка ОС Astra Linux версии 1.7 для работы с Natch

Для работы лицензионной копии *Natch* на ОС Astra необходимо разрешить трассировку `ptrace`. Для этого нужно выполнить следующие действия:

*Пуск -> Панель управления -> Безопасность -> Политика безопасности ->
Настройка безопасности -> Системные параметры -> Снять галочку с "Блокировать трассировку ptrace для всех пользователей"*.

## <a name="setup_snatch"></a>2.3. Установка графической подсистемы SNatch

Для работы *SNatch* необходимо подготовить окружение, а именно, установить ряд пакетов для хостовой ОС и Python, а также создать базу данных.
Это делается автоматически с помощью скрипта `snatch_setup.sh`. Для установки потребуется пароль для sudo. Важно! Запускать скрипт под sudo не нужно,
дождитесь запроса пароля. Пакеты для Python устанавливаются в виртуальную среду, таким образом пакеты на вашей машине не будут
переустанавливаться и конфликтовать. Запускать скрипт нужно только при первом использовании, его повторный запуск приведет к удалению базы данных.

Установка *SNatch* включает в себя:

1. Распаковка архива snatch.tar.gz
2. Запуск скрипта `snatch_setup.sh`

Обращаем ваше внимание, что для ОС Astra Linux версии 1.7 подсистема *SNatch* не предусмотрена. Изучать результаты, полученные в Astra, можно будет на любой другой поддерживаемой ОС.

